<!doctype html>
<html lang="en">

<head>
    <meta charset="utf8">
    <title>Weather App - JS</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <style>
        body {
            margin: auto;
            max-width: 400px;
            font-family: sans-serif;
        }
    </style>
</head>

<body>

    <pre id="result"></pre>
    <h1>Weather App</h1>

    <main class="">
        <section class="form">
            <form id="form1" action="#" onsubmit="return validateForm(this);">
                City Name: <input type="text" name="city">

                <button>Submit</button>
                <p id="valid-city-error" style="color:red;"></p>
            </form>
            <div id="submission-message"></div>
            <div id="weather-api-data"></div>
        </section>

        <section id="five-day">
            <div id="forecast"></div>

        </section>


    </main>

    <script>
        // converting kelvin to fahrenheit
        function kelvinToF(value) {
            var fahrenheit = (((Number(value) - 273.15) * 9) / 5) + 32;
            return fahrenheit.toFixed(2);
        }

        $('button').on('click', function(e) {
                    e.preventDefault(); // prevents normal submission behavior

                    // JSON form values
                    var city = $('input').val();

                    requestJSON(requri, function(json) {
                                if (json.message == "Not Found" || username == '') {
                                    $('#weather-api-data').html("<h2>City Not Found</h2>");
                                } else {
                                    // else we have a user and we display their info
                                    var forecast_date = new Date(json.dt);
                                    var temp = json.temp;
                                    var min = json.temp_min;
                                    var max = json.temp_max;
                                    var description = json.main;
                                    var desc_icon = json.icon;

                                    var outhtml = '<h2>' + city + ' <span class="smallname">' + forecast_date + '</span></h2>';
                                    outhtml = outhtml + '<div class="ghcontent"><div class="avi"><a href="' + profileurl + '" target="_blank"><img src="' + aviurl + '" width="80" height="80" alt="' + username + '"></a></div>';
                                    outhtml = outhtml + '<p>Followers: ' + followersnum + ' - Following: ' + followingnum + '<br>Repos: ' + reposnum + '</p></div>';
                                    outhtml = outhtml + '<div class="repolist clearfix">';


                                });

                            function requestJSON(url, callback) {
                                $.ajax({
                                    url: "http://api.openweathermap.org/data/2.5/forecast?id=524901&APPID={cafd099fedfea4fbea224c1252885dd3}",
                                    complete: function(xhr) {
                                        callback.call(null, xhr.responseJSON);
                                    }
                                });
                            }

                            // converting forecast string to date format




                            requestJSON(requri, function(json) {

                                    // const cities = [];
                                    // var apiKey = "cafd099fedfea4fbea224c1252885dd3";
                                    // var jsonURL = "http://api.openweathermap.org/data/2.5/forecast?id=524901&APPID={cafd099fedfea4fbea224c1252885dd3}";

                                    // $.getJSON(jsonURL, function(data) {
                                    //     $('#result').text(JSON.stringify(data, null, 2));
                                    // }, "json");

                                    // http://api.openweathermap.org/data/2.5/forecast?id=524901&APPID={cafd099fedfea4fbea224c1252885dd3}


                                    $(document).ready(function() {
                                        $('form button').on('click', function(e) {
                                            //cancel the default form submission
                                            e.preventDefault();
                                            //gather up all form-field values
                                            var city = $('#form1').serialize();
                                            console.log(city);

                                            //send the request
                                            $.post("http://api.openweathermap.org/data/2.5/forecast?id=524901&APPID={cafd099fedfea4fbea224c1252885dd3}", formData, function(result, status) {
                                                //when the server replies...
                                                if (status == "success") {
                                                    $('#message').text('POST succeeded');
                                                } else {
                                                    $('#message').text('POST failed');
                                                }
                                                $('form button').removeAttr('disabled');
                                            });

                                            //temporarily disable button to prevent double-submit
                                            // this happens before post completes
                                            $('form button').attr('disabled', 'disabled');
                                        });

                                        // receive JSON data from server
                                        $.getJSON(URL, function(data, status) {
                                            if (status == "success") {
                                                // handle successful request
                                                var forecast_date = new Date(json.list.dt);
                                                var temp = json.list.main.temp;
                                                var min = json.list.main.temp_min;
                                                var max = json.list.main.temp_max;
                                                var humidity = json.list.main.humidity;
                                                var description = json.list.weather.main;
                                                var desc_icon = json.list.weather.icon;

                                                var outhtml = '<h2>' + city + ' <span class="smallname">' + forecast_date + '</span></h2>';

                                                outhtml = outhtml + '<div class="ghcontent"><div class="avi"><a href="' + profileurl + '" target="_blank"><img src="' + aviurl + '" width="80" height="80" alt="' + username + '"></a></div>';
                                                outhtml = outhtml + '<p>Followers: ' + followersnum + ' - Following: ' + followingnum + '<br>Repos: ' + reposnum + '</p></div>';
                                                outhtml = outhtml + '<div class="repolist clearfix">';
                                            } else {
                                                // request failed
                                                $('#weather-api-data').html("<h2>City Not Found</h2>");
                                            }
                                        });
                                    });
    </script>


</body>

</html>